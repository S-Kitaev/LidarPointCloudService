# Методика и план испытаний (ПМИ)

**Проект:** Система съёмки и визуализации 3D облаков точек (LiDAR)

**Документ:** Методика испытаний ПО (тест-план)

**Версия:** 1.0

## 1. Введение

Система — веб-приложение для управления удалённым LiDAR-устройством (RPLIDAR на 
поворотной платформе), съёмки и визуализации облаков точек. Аппаратная часть: 
2D-LiDAR, мотор (поворотная платформа), контроллер Raspberry Pi. 
Контроллер подключается по Wi-Fi и SSH к хост-ПК. На хосте работает 
FastAPI-приложение, PostgreSQL в Docker. ПО умеет: запускать съёмку, 
сохранять .txt-файлы облака на плате, скачивать их на хост, загружать в 
локальную БД, визуализировать (JS/WebGL) и синхронизировать с ЦХД.

Краткая архитектура:

- Аппаратная часть: RPLIDAR A1 + шаговый двигатель (Nema 23) + Raspberry Pi.
- Связь: Wi-Fi (Raspberry Pi ↔ локальная сеть), SSH/SFTP для управления и передачи файлов.
- Хост: FastAPI (Docker), PostgreSQL (Docker), фронтенд (JS/Three.js или Potree).
- ЦХД: внешний центр хранения данных (опционально), синхронизируется через API/SFTP


## 2. Цель испытаний

Провести комплексные функциональные и интеграционные испытания ПО и взаимодействия с 
аппаратной частью для подтверждения работоспособности системы по всем ключевым 
сценариям:

- запуск и корректный поднятый стек в Docker;
- регистрация/авторизация (JWT);
- загрузка облака точек в БД и отображение;
- визуализация облака;
- подключение и синхронизация с ЦХД;
- подключение к плате по SSH;
- тест лидара и двигателя скриптами;
- съёмка облака в 2 вариантах параметров;
- скачивание облака с платы;
- полный рабочий цикл end-to-end.

## 3. Объём и границы испытаний

### Включено:
все 12 указанных тестов (см. список ниже). Тестируются функциональность API, 
веб-интерфейса, интеграция с Raspberry Pi и физическая работа LiDAR/двигателя 
(через скрипты). Тестирование производительности частично (время обработки и SLA) 
и отказоустойчивости сети (симуляция разрывов Wi-Fi) — базовая проверка.
### Исключено:
нагрузочное тестирование на масштабируемость (Kubernetes/кластерная эксплуатация), 
глубокая физическая валидация LiDAR (калибровка при промышленных точностях), 
долговременные стресс-тесты сверх 8 часов (по согласованию).

## 4. Список тестовых элементов

1. Запуск ПО — проверка запуска приложения в Docker без ошибок.
2. Корректная работа JWT — регистрация/авторизация, проверка записи в БД.
3. Загрузка облака точек в БД — проверка сохранения и метаданных.
4. Визуализация облака точек — корректное отображение в браузере.
5. Подключение к ЦХД и синхронизация с локальной БД.
6. Подключение из ПО к плате по SSH (пинг, SFTP, запуск тестов).
7. Тест работоспособности LiDAR через скрипт (lidar.py).
8. Тест работоспособности двигателя через скрипт (engine.py).
9. Съёмка облака (вариант 1) — параметры: «мелкий шаг, короткая длительность».
10. Съёмка облака (вариант 2) — параметры: «большой шаг, увеличенная длительность».
11. Скачивание облака точек с платы на хост (SFTP), проверка контрольной суммы.
12. Полный рабочий цикл (end-to-end): регистрация → авторизация → съёмка → скачивание → загрузка в БД → визуализация → загрузка в ЦХД.

## 5. Требования к стенду / окружение тестирования

### Аппаратное:
- Raspberry Pi (с установленным ПО LiDAR и скриптами), подключённый к мотору.
- Шаговый двигатель и драйвер, подключённые и настроенные.
- Хост-ПК с Docker/Docker Compose, доступный по SSH/веб (браузер).

### ПО/сервисы
- Docker Desktop / Docker Engine + Docker Compose.
- Образы: app (FastAPI), postgres (PostgreSQL), frontend (если отдельно), прочие сервисы.
- Наличие psql или UI для проверки БД.
- Браузер с доступом к ```http://localhost:8001/``` (или адресу сервера).
- Доступ в сеть (для скачивания образов/зависимостей), либо локальные образы

### Утилиты:
- ssh, scp/sftp на хосте.
- curl/httpie для API тестов.
- psql для SQL-проверок.
- Скрипты тестирования LiDAR/двигателя (lidar.py, engine.py) на Raspberry Pi.
- Логи Docker ```docker compose logs -f app```


## 6. Метрики и критерии оценки

Общие критерии успешности (для каждого теста далее прописаны конкретные значения):

- Успешный старт контейнеров: docker compose up завершился, сервис app отвечает на /health или /docs. (Критерий PASS: HTTP 200, отсутствуют ERROR в логах на старте).
- JWT / регистрация: успешная регистрация → HTTP 201; логин → HTTP 200; cookie Authorization установлена; запись пользователя в таблице users. (PASS: код 200/201, запись в БД).
- Синхронизация / ЦХД: после синхронизации все метаданные и файлы доступны; потери ≤1%. (PASS: все файлы доступны, контрольные суммы совпадают).
- SSH подключение: ssh пинг/выполнение команды возвращает код 0; SFTP скачивает файл. (PASS: код возврата 0, файл цел).
- LiDAR тесты: lidar.py возвращает статус success; лог содержит отсутствие ошибок; измерение дистанций в ожидаемом диапазоне. (PASS: код 0, лог OK).
- Двигатель: engine.py выполняет поворот на заданные углы; абсолютное отклонение ≤2°. (PASS: отклонение ≤2°, отсутствие пропусков шагов).
- Съёмки (варианты): облако собрано, процент пропусков точек ≤5%, RMS ошибки относительно эталона (при эталоне) ≤ заданного порога. (PASS: визуально корректно, пропуски ≤5%).
- Скачивание: контрольная сумма совпадает (md5/sha256). (PASS: совпадает).
- Визуализация: облако загружается, отображение без артефактов; интерактивность (вращение/зум) работает. (PASS: визуально вручную подтверждено; автоматическая проверка — элемент DOM/скрипт завершил рендер).
- Полный цикл: все стадии прошли успешно; время выполнения в пределах SLA (опционально, например ≤ 60 s для 100k точек). (PASS: все стадии — PASS).

## 7. Общая матрица тестов

| №  | Название теста | Основные варьируемые параметры | Ожидаемый результат | Критерии оценки / Метрика |
|----|---------|----|-------------------|---|
| 1  |Запуск в Docker| —  | Сервисы подняты без ошибок |  docker compose up без фатальных ошибок; /health → 200 |
| 2  |JWT (регистрация/аунтефикация) | валид/невалид данные | Регистрация/вход  | HTTP 201/200; запись в users; cookie Authorization  |
| 3  |Загрузка в БД| разные файлы облака | Метаданные + ссылки сохранены | GET /api/... возвращает записьа |
| 4  |Визуализация | —  | Отображение в браузере |  UI рендерит облако; интерактивность в пределах SLA |
| 5  |Подключение к ЦХД | скорость сети, обрыв | Синхронизация метаданных и файлов |  потери ≤1%; все файлы доступны |
| 6  |SSH подключеие к плате | сеть, credentials | Удалённое выполнение команд |  ssh return 0; sftp скачивает |
| 7  |Тест LiDAR| —  | lidar.py → success | код 0, логи OK  |
| 8  |Тест двигателя | шаг, скорость | engine.py выполняет поворот | отклонение ≤2°; нет пропусков шагов  |
| 9  |Съёмка 1 | шаг=5°, длительность=1s | Облако снято и сохранено | пропуски ≤5%; файл создан  |
| 10 |Съёмка 2 | шаг=2°, длительность=3s | Облако снято, плотный сбор точек | пропуски ≤3%; файл создан  |
| 11 |Скачивание | сеть | Файл скачан и checksum OK| checksum совпадает |
| 12 |Полный цикл | —  | Все этапы успешны | Все этапы PASS|


