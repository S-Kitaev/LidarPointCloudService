# Пошаговая инструкция по созданию рабочей платы Raspberry Pi для проекта LiDAR

Если вам необходима только какая-то часть настройки платы, переходите к соответствующему разделу.

---

## 1. Сборка системы
Выполните сборку системы съёмки облака точек согласно файлу:

**`build.md`**

---

## 2. Подготовка SD-карты

### 2.1 Что такое Raspberry Pi 3
Плата Raspberry Pi 3 — полностью самостоятельный мини-компьютер.  
Для настройки можно подключить:
- мышь и клавиатуру по USB
- монитор по HDMI

### 2.2 Форматирование SD-карты
Жестким диском Raspberry является SD-карта.  
Её необходимо **отформатировать**, что можно сделать средствами Windows, если карта подключена через адаптер.

---

## 3. Установка Raspberry Pi OS

1. скачиваем Raspberry Pi Imager  
2. устанавливаем ОС Raspberry на SD-карту  

Рекомендуемые параметры: **Raspberry Pi 3 (64-bit)**

---

## 4. Базовая настройка системы

Если работа выполняется на компьютере МИФИ, по умолчанию будут установлены:

- login: vr
- password: vr

Если выполняете настройку сами, обязательно задайте именно эти данные.  
Все скрипты используют именно эти параметры!

Если требуется на плату установить другие параметры, тогда для корректной работы ПО измените параметры также и в файле .env

---

## 5. Включение автоматического подключения к Wi-Fi

Открываем файл настроек:
```commandline
sudo nano /etc/wpa_supplicant/wpa_supplicant.conf
```
Вставляем:
```bash
country=RU
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1

network={
    ssid="TP-Link_931A"
    psk="68009878"
    key_mgmt=WPA-PSK
}
```
Сохраняем и перезапускаем:

```bash
sudo systemctl restart wpa_supplicant@wlan0
sudo reboot
```
Включаем SSH
```commandline
sudo systemctl enable --now ssh
sudo systemctl status ssh --no-pager
sudo reboot
```
---
## 6. Проверка подключения по SSH c хоста
Подключаемся:

```bash
ssh vr@192.168.0.101
```
Если ошибка ключа:

```bash
ssh-keygen -R 192.168.0.101
```
Пароль для подключения: ```vr```

---
## 7. Перенос файлов на Raspberry Pi

Передача папки (пример):
```bash
scp -r "<<Корень проекта>>\raspberry\lidar" vr@192.168.0.101:/home/vr/Desktop
```
Важно:
- необходимо копировать папку, а не архив
- файлы должны быть размещены на рабочем столе на плате

Если требуется размещение в другом месте, измените этот 
параметр также и в файле .env проекта

### 7.1 Установка зависимостей
После переноса файлов:

- отключиться от Wi-Fi лидара
- подключиться к Wi-Fi с интернетом
- активировать виртуальное окружение:
```commandline
source .venv/bin/activate
```
- выполнить:

```commandline
pip3 install -r requirements.txt
```

### 7.2 Проверка работы скриптов на плате
- отключиться от Wi-Fi с интернетом
- подключиться к Wi-Fi платы
- перейти в папку lidar
- запуск тестовых скриптов:
```commandline
python engine.py
```
```commandline
python lidar.py
```
---
## 8. Проверка работоспособности
Работоспособность приложения можно проверить с помощью соответствующих 
кнопок на странице ```Снять облако точек``` в ПО Lidar:
- ```Проверить соединение с лидаром``` - Пингует raspberry, возвращает результат от raspberry
- ```Подключиться к плате``` - Выполняет подключение к плате и весь процесс настройки платы
- ```Проверка лидара``` - Проверяет работу лидара (10 секунд)
- ```Проверка двигателя``` - Проверяет работу двигателя (поворачивает его на +240 и -240 градусов)
- ```Запуск съемки``` - Выполняет съемку облака точек с заданными параметрами съемки
- ```Прервать съемку``` - Останавливает съемку (в процессе доработки)
- ```Скачать облако точек``` - Скачивает в папку ```/scans``` файл съемки с платы ```scan_<<время съемки>>.txt```


Если всё сделано в строгом соответствии с инструкцией — плата 
готова к полноценной работе.

---